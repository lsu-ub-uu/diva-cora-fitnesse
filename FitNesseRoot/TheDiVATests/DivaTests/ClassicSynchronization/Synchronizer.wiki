---
Test
---
!2 !-Organisationsindexering-!
För att testa att Cora biten av indexering av personer fungerar när ändringar görs i Classic, simulerar vi här anrop, som normalt sker från Classic till !-IndexServleten-! vid ändringar i personposter.

Parametrar är recordType, recordId och workOrderType, varav de första två är obligatoriska. För parametern workOrderType är default-värdet "index". 

!define baseUrl {http://synchronizer:8080}
!***> Configure !-RestFixture-!

| Table:smartrics.rest.fitnesse.fixture.RestFixtureConfig | |
| http.client.connection.timeout | 7000 |

*!

!define recordType {topOrganisation}
!define recordId {1}

!***> Indexera record ${recordType} med ID ${recordId}

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${baseUrl} |
| GET | /synchronizer/synchronizer/index?recordType=${recordType}&recordId=${recordId} | 200 | Content-Length: 0 | no-body |

*!

!***> Använd publicOrganisationSearch för att söka efter recordId ${recordId} och säkerställ att den hittas


!| RecordEndpointFixture |
| authToken | searchId | json | testSearchRecord? | getStatusType? |
| $adminAuthToken | publicOrganisationSearch | {"name":"search","children":[{"name":"include","children":[{"name":"includePart","children":[{"name":"recordIdSearchTerm","value":"${recordId}"}]}]}]} | =~/"name":"id","value":"1"/ | OK |

*!


!***> Ta bort indexeringen för record ${recordType} med ID ${recordId}

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${baseUrl} |
| GET | /synchronizer/synchronizer/index?recordType=${recordType}&recordId=${recordId}&workOrderType=removeFromIndex | 200 | Content-Length: 0 | no-body |

*!

!***> Använd publicOrganisationSearch för att söka efter recordId ${recordId} och säkerställ att den inte hittas


!| RecordEndpointFixture |
| authToken | searchId | json | testSearchRecord? | getStatusType? |
| $adminAuthToken | publicOrganisationSearch | {"name":"search","children":[{"name":"include","children":[{"name":"includePart","children":[{"name":"recordIdSearchTerm","value":"${recordId}"}]}]}]} | =~/"totalNo":"0"/ | OK |

*!


!***> Indexera record ${recordType} med ID ${recordId}

| Table:smartrics.rest.fitnesse.fixture.RestFixture | ${baseUrl} |
| GET | /synchronizer/synchronizer/index?recordType=${recordType}&recordId=${recordId} | 200 | Content-Length: 0 | no-body |

*!

!***> Använd publicOrganisationSearch för att söka efter recordId ${recordId} och säkerställ att den hittas


!| RecordEndpointFixture |
| authToken | searchId | json | testSearchRecord? | getStatusType? |
| $adminAuthToken | publicOrganisationSearch | {"name":"search","children":[{"name":"include","children":[{"name":"includePart","children":[{"name":"recordIdSearchTerm","value":"${recordId}"}]}]}]} | =~/"name":"id","value":"1"/ | OK |

*!

!***> Vi tar bort indexeringen för poster som sök testet ej förväntar sig skall vara indexerade
!define currentAuthToken {$adminAuthToken}
!| RecordEndpointFixture |
| authToken | type | json | testCreateRecord? | getStatusType? | 
| ${currentAuthToken} | workOrder | {"name":"workOrder","children":[{"name":"recordType","children":[{"name":"linkedRecordType","value":"recordType"},{"name":"linkedRecordId","value":"topOrganisation"}]},{"name":"recordId","value":"1"},{"name":"type","value":"removeFromIndex"}]} | | CREATED |
*!