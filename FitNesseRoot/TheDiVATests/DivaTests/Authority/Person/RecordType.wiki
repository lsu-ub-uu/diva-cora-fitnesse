---
Static
---
!2 Metadata
!3 Fält och begränsningar:
!style_red[en inloggad användare skall kunna uppdatera "sin egen" personpost, men med begränsningar, dessa är ännu inte inlagda ]
Det som står listat här för uppdatering och läsning (ej ny) och namnen som står är nameInData.

!4 Person
 * person (group)
   * recordInfo (group, 1-1, '''noRestrictions''')
     * id (textVar, 1-1, '''write ''')
     * type (link, 1-1, '''write ''')
     * createdBy (link, 1-1, '''readWrite ''')
     * dataDivider (link, 1-1, '''write ''')
     * tsCreated (textVar, 1-1, '''write ''')
     * updated(group, 1-X, '''readwrite''')
     * public (colVar, 1-1, '''readWrite ''')
     * domain (domain, 0-X, '''readWrite''')
   * authorisedName (textVar, 1-1, '''noRestrictions''')
     * firstName(textVar, 0-1,'''noRestrictions''')
   * lastName(textVar, 0-1,'''noRestrictions''')
   * academicTitle (textVar, 0-1, '''readWrite''')
   * yearOfBirth (textVar, 0-1, '''readWrite''')
   * yearOfDeath (textVar, 0-1, '''readWrite''')
   * emailAddress (textVar, 0-1, '''readWrite''')
   * alternativeName (group, 0-X, '''readWrite''')
     * givenName (textVar, 0-1, '''noRestrictions ''')
     * familyName (textVar, 0-1, '''noRestrictions ''')
   * externalURL (group, 0-X, '''readWrite''')
     * linkTitle (textVar, 1-1, '''noRestrictions ''')
     * URL (textVar, 1-1, '''noRestrictions ''')
   * otherAffiliation (group, 0-X, '''readWrite''')
     * affiliation (textVar, 1-1, '''noRestrictions ''')
     * affiliationFromYear (textVar, 0-1, '''noRestrictions ''')
     * affiliationUntilYear (textVar, 0-1, '''noRestrictions ''')
   * ORCID_ID (textVar, 0-X, '''readWrite''')
   * VIAF_ID (textVar, 0-X, '''readWrite''')
   * Libris_ID(textVar, 0-X, '''readWrite''')
   * biographyEnglish (group, 0-1, '''readWrite''')
     * language (colVar, 1-1, '''noRestrictions ''')
     * biography (textVar, 1-1, '''noRestrictions ''')
   * biographySwedish (group, 0-1, '''readWrite''')
     * language (colVar, 1-1, '''noRestrictions ''')
     * biography (textVar, 1-1, '''noRestrictions ''')
   * personDomainPart (group , 0-X, '''readWrite''')

!4 !-PersonDomainPart-!

!5 ''' !-PersonDomainPart-! för ny '''
 * personDomainPart(group)
   * recordInfo (group, 1-1, '''noRestrictions''')
     * dataDivider (link, 1-1, '''noRestrictions''')
     * domain (domain, 1-1, '''noRestrictions''')
   * identifier(textVar, 0-X, '''noRestrictions''') 
   * personLink(recordLink, 1-1, '''noRestrictions''') ''' Används bara vid skapelse för att koppla rätt personpost. '''
   * affiliation(group, 0-X, '''noRestrictions''')
     * organisationLink (recordLink, 1-1, '''noRestrictions ''')
     * affiliationFromYear (textVar, 0-1, '''noRestrictions ''')
     * affiliationUntilYear (textVar, 0-1, '''noRestrictions ''')

   identifier och affiliation får inte båda vara 0.

!5 ''' Vanlig '''
 * personDomainPart(group)
   * recordInfo (group, 1-1, '''noRestrictions''')
     * id (textVar, 1-1, '''write ''') ''' Id skickas inte vid skapelse, den genereras med hjälp av personLink och domain. '''
     * type (link, 1-1, '''write ''')
     * createdBy (link, 1-1, '''readWrite ''')
     * dataDivider (link, 1-1, '''write ''')
     * tsCreated (textVar, 1-1, '''write ''')
     * updated(group, 1-X, '''readWrite''')
     * public (colVar, 1-1, '''readWrite ''')
     * domain (domain, 1-1, '''readWrite''')
   * identifier(textVar, 0-X, '''readWrite''') 
   * affiliation(group, 0-X, '''noRestrictions''')
     * organisationLink (recordLink, 1-1, '''noRestrictions ''')
     * affiliationFromYear (textVar, 0-1, '''noRestrictions ''')
     * affiliationUntilYear (textVar, 0-1, '''noRestrictions ''')

   identifier och affiliation får inte båda vara 0.

!3 !-RecordType-!
!***> Person

!***> Läs posttyp Person

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | person | | OK |

*!
Läs topnivå metadatagruppen för en '''ny''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till  personNewGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personNewGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 15 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | recordInfoDivaAutogeneratedNewGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadata | personNameGroup | 1 | 1 | authorisedName | noRestrictions |
| $adminAuthToken | metadata | personAcademicTitleTextVar | 0 | 1 | academicTitle | readWrite |
| $adminAuthToken | metadata | yearOfBirthTextVar | 0 | 1 | yearOfBirth | readWrite |
| $adminAuthToken | metadata | yearOfDeathTextVar | 0 | 1 | yearOfDeath | readWrite |
| $adminAuthToken | metadata | personEmailTextVar | 0 | 1 | emailAddress | readWrite |
| $adminAuthToken | metadata | personAlternativeNameGroup | 0 | X | alternativeName | readWrite |
| $adminAuthToken | metadata | personURLGroup | 0 | X | externalURL | readWrite |
| $adminAuthToken | metadata | personDomainPartLink | 0 | X | personDomainPart | readWrite |
| $adminAuthToken | metadata | personOtherAffiliationGroup | 0 | X | otherAffiliation | readWrite |
| $adminAuthToken | metadata | personORCIDValueTextVar | 0 | X | ORCID_ID | readWrite |
| $adminAuthToken | metadata | personVIAFValueTextVar | 0 | X | VIAF_ID | readWrite |
| $adminAuthToken | metadata | personLibrisValueTextVar | 0 | X | Libris_ID | readWrite |
| $adminAuthToken | metadata | personBiographyEnglishGroup | 0 | 1 | biographyEnglish | readWrite |
| $adminAuthToken | metadata | personBiographySwedishGroup | 0 | 1 | biographySwedish | readWrite |

*!
!***> Kontrollera recordInfoDivaAutogeneratedNewGroup

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoDivaAutogeneratedNewGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 1 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | dataDividerDivaLink | 1 | 1 | dataDivider | noRestrictions |

*!
Läs topnivå metadatagruppen för en '''befintlig''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till personGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 15 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | recordInfoPersonDivaGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadata | personNameGroup | 1 | 1 | authorisedName | noRestrictions |
| $adminAuthToken | metadata | personAcademicTitleTextVar | 0 | 1 | academicTitle | readWrite |
| $adminAuthToken | metadata | yearOfBirthTextVar | 0 | 1 | yearOfBirth | readWrite |
| $adminAuthToken | metadata | yearOfDeathTextVar | 0 | 1 | yearOfDeath | readWrite |
| $adminAuthToken | metadata | personEmailTextVar | 0 | 1 | emailAddress | readWrite |
| $adminAuthToken | metadata | personAlternativeNameGroup | 0 | X | alternativeName | readWrite |
| $adminAuthToken | metadata | personURLGroup | 0 | X | externalURL | readWrite |
| $adminAuthToken | metadata | personDomainPartLink | 0 | X | personDomainPart | readWrite |
| $adminAuthToken | metadata | personOtherAffiliationGroup | 0 | X | otherAffiliation | readWrite |
| $adminAuthToken | metadata | personORCIDValueTextVar | 0 | X | ORCID_ID | readWrite |
| $adminAuthToken | metadata | personVIAFValueTextVar | 0 | X | VIAF_ID | readWrite |
| $adminAuthToken | metadata | personLibrisValueTextVar | 0 | X | Libris_ID | readWrite |
| $adminAuthToken | metadata | personBiographyEnglishGroup | 0 | 1 | biographyEnglish | readWrite |
| $adminAuthToken | metadata | personBiographySwedishGroup | 0 | 1 | biographySwedish | readWrite |

*!
Läst in metadatagruppen recordInfoPersonDivaGroup för senare kontroll

!***> Kontrollera recordInfoPersonDivaGroup

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoPersonDivaGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 8 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | idTextVar | 1 | 1 | id | write |
| $adminAuthToken | metadata | recordTypeLink | 1 | 1 | type | write |
| $adminAuthToken | metadata | createdByLink | 1 | 1 | createdBy | readWrite |
| $adminAuthToken | metadata | dataDividerDivaLink | 1 | 1 | dataDivider | write |
| $adminAuthToken | metadata | tsCreatedTextVar | 1 | 1 | tsCreated | write |
| $adminAuthToken | metadata | updatedGroup | 1 | X | updated | readWrite |
| $adminAuthToken | metadata | personPublicCollectionVar | 1 | 1 | public | readWrite |
| $adminAuthToken | metadata | domainCollectionVar | 0 | X | domain | readWrite |

*!
!***> Kontrollera updated

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | updatedGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | updatedByLink | 1 | 1 | updatedBy | noRestrictions |
| $adminAuthToken | metadata | tsUpdatedTextVar | 1 | 1 | tsUpdated | noRestrictions |

*!
!***> Kontrollera authorisedName

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personNameGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | firstNameTextVar | 0 | 1 | givenName | noRestrictions |
| $adminAuthToken | metadata | lastNameTextVar | 0 | 1 | familyName | noRestrictions |

*!
!***> Kontrollera alternativeName

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personAlternativeNameGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | firstNameTextVar | 0 | 1 | givenName | noRestrictions |
| $adminAuthToken | metadata | lastNameTextVar | 0 | 1 | familyName | noRestrictions |

*!
!***> Kontrollera externalURL

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personURLGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | personExternalURLLabelTextVar | 1 | 1 | linkTitle | noRestrictions |
| $adminAuthToken | metadata | personExternalURLTextVar | 1 | 1 | URL | noRestrictions |

*!
!***> Kontrollera otherAffiliation

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personOtherAffiliationGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 3 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | personOtherAffiliationTextVar | 1 | 1 | affiliation | noRestrictions |
| $adminAuthToken | metadata | personAffiliationFromTextVar | 0 | 1 | affiliationFromYear | noRestrictions |
| $adminAuthToken | metadata | personAffiliationUntilTextVar | 0 | 1 | affiliationUntilYear | noRestrictions |

*!
!***> Kontrollera biographyEnglish

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personBiographyEnglishGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | engLanguageCollectionVar | 1 | 1 | language | noRestrictions |
| $adminAuthToken | metadata | personBiographyTextVar | 1 | 1 | biography | noRestrictions |

*!
!***> Kontrollera biographySwedish

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personBiographySwedishGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | sweLanguageCollectionVar | 1 | 1 | language | noRestrictions |
| $adminAuthToken | metadata | personBiographyTextVar | 1 | 1 | biography | noRestrictions |

*!
*!
!***> !-PersonDomainPart-!

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | personDomainPart | | OK |

Läs topnivå metadatagruppen för en '''ny''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till  personDomainPartNewGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personDomainPartNewGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 4 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | recordInfoAutogeneratedDomainNewGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadata | personLink | 1 | 1 | personLink | noRestrictions |
| $adminAuthToken | metadata | personLocalValueTextVar | 0 | X | identifier | noRestrictions |
| $adminAuthToken | metadata | personAffiliationGroup | 0 | X | affiliation | noRestrictions |

Kontrollera recordInfo

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoAutogeneratedDomainNewGroup | |

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 2 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | dataDividerDivaLink | 1 | 1 | dataDivider | noRestrictions |
| $adminAuthToken | metadata | domainCollectionVar | 1 | 1 | domain | noRestrictions |

*!
Läs topnivå metadatagruppen för en '''befintlig''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till personDomainPartGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personDomainPartGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 3 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | recordInfoWithDomainGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadata | personLocalValueTextVar | 0 | X | identifier | readWrite |
| $adminAuthToken | metadata | personAffiliationGroup | 0 | X | affiliation | noRestrictions |

Kontrollera recordInfo

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | recordInfoWithDomainGroup | |

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 8 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | idTextVar | 1 | 1 | id | write |
| $adminAuthToken | metadata | recordTypeLink | 1 | 1 | type | write |
| $adminAuthToken | metadata | createdByLink | 1 | 1 | createdBy | readWrite |
| $adminAuthToken | metadata | dataDividerDivaLink | 1 | 1 | dataDivider | write |
| $adminAuthToken | metadata | tsCreatedTextVar | 1 | 1 | tsCreated | write |
| $adminAuthToken | metadata | updatedGroup | 1 | X | updated | readWrite |
| $adminAuthToken | metadata | personPublicCollectionVar | 1 | 1 | public | readWrite |
| $adminAuthToken | metadata | domainCollectionVar | 1 | 1 | domain | readWrite |

*!
!***> Kontrollera affiliation

Läs in

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadata | personAffiliationGroup | |

Kontrollera barnen

!| ChildComparerFixture |
| expectedNumberOfChildren | testCheckNumberOfChildren? |
| 3 | OK |

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadata | divaOrganisationLink | 1 | 1 | organisationLink | noRestrictions |
| $adminAuthToken | metadata | personAffiliationFromTextVar | 0 | 1 | affiliationFromYear | noRestrictions |
| $adminAuthToken | metadata | personAffiliationUntilTextVar | 0 | 1 | affiliationUntilYear | noRestrictions |

*!
*!
!3 Roller
Notera att rättigheterna som kontrolleras i det här avsnittet gäller, vilka rättigheter man har på postTypen inte enstaka poster. Rättigheterna för enstaka poster kontrolleras under de olika testerna för rättigheter så som read, update, etc.

!4 !-SystemAdmin-!
!-SystemAdmin har tillgång till validate, list och search för person postTypen-!

!style_red[Validate och batch_index för personpost är inte implementerade än, därför finns de med i expectedPermissionResult ]
!***> Kontrollera de actions systemAdmin får med i recordType för person
!define currentAuthToken {$systemAdminAuthToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!***> Kontrollera de actions systemAdmin får med i recordType för personDomainPart
!define currentAuthToken {$systemAdminAuthToken}
!define currentRecordType {personDomainPart}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action validate is missing. Action batch_index is missing.}
#!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!4 !-DomainAdmin-!
!-DomainAdmin har tillgång till validate och search för person  postTypen-!

!***> Kontrollera de actions domainAdmin får med i recordType för person
!define currentAuthToken {$domainAdminUUAuthToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action list is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!***> Kontrollera de actions domainAdmin får med i recordType för personDomainPart
!define currentAuthToken {$domainAdminUUAuthToken}
!define currentRecordType {personDomainPart}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action validate is missing. Action list is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!4 !-Guest-!
!-Guest har tillgång till search för person postTypen-!

!***> Kontrollera de actions guest får med i recordType för person
!define currentAuthToken {$guestToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action list is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!***> Kontrollera de actions guest får med i recordType för personDomainPart
!define currentAuthToken {$guestToken}
!define currentRecordType {personDomainPart}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action list is missing. Action batch_index is missing.}
!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
