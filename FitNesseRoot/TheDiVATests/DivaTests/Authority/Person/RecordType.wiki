---
Test
---
!2 Metadata
!3 Fält och begränsningar:
!style_red[Begränsningarna är inte satta än]
!style_red[guest skall inte se: födelse-/dödsår, e-postadress eller lokalt id. så de måste ha läsbegränsningar]
!style_red[en inloggad användare skall kunna uppdatera "sin egen" personpost, men med begränsningar, dessa är ännu inte inlagda ]
Det som står listat här är nameInData. 

!4 Person
 * person(group)
   * recordInfo(group, 1-1, '''noRestrictions''')
     * id (textVar, 1-1, '''noRestrictions ''')
     * type (link, 1-1, '''noRestrictions ''')
     * createdBy (link, 1-1, '''noRestrictions ''')
     * dataDivider (link, 1-1, '''noRestrictions ''')
     * tsCreated (textVar, 1-1, '''noRestrictions ''')
     * updated(group, 1-X, '''noRestrictions''')
     * public (colVar, 1-1, '''noRestrictions ''')
     * domain (domain, 1-X, '''noRestrictions ''')
   * authorisedName(textVar, 1-1, '''noRestrictions''')
   * academicTitle(textVar, 0-1, '''noRestrictions''')
   * yearOfBirth(textVar, 0-1, '''noRestrictions''')
   * yearOfDeath(textVar, 0-1, '''noRestrictions''')
   * emailAddress(textVar, 0-1, '''noRestrictions''')
   * alternativeName(group, 0-X, '''noRestrictions''')
     * givenName (textVar, 0-1, '''noRestrictions ''')
     * familyName (textVar, 0-1, '''noRestrictions ''')
   * externalURL(group, 0-X, '''noRestrictions''')
     * linkTitle (textVar, 1-1, '''noRestrictions ''')
     * URL (textVar, 1-1, '''noRestrictions ''')
   * affiliation(group, 0-X, '''noRestrictions''')
     * organisationLink (recordLink, 1-1, '''noRestrictions ''')
     * affiliationFromYear (textVar, 0-1, '''noRestrictions ''')
     * affiliationUntilYear (textVar, 0-1, '''noRestrictions ''')
   * otherAffiliation(group, 0-X, '''noRestrictions''')
     * affiliation (textVar, 1-1, '''noRestrictions ''')
     * affiliationFromYear (textVar, 0-1, '''noRestrictions ''')
     * affiliationUntilYear (textVar, 0-1, '''noRestrictions ''')
   * localIdentifier(group, 0-X, '''noRestrictions''')
     * domain (colVar, 1-1, '''noRestrictions ''')
     * identifier (textVar, 1-1, '''noRestrictions ''')
   * ORCID_ID(textVar, 0-X, '''noRestrictions''')
   * VIAF_ID(textVar, 0-X, '''noRestrictions''')
   * Libris_ID(textVar, 0-X, '''noRestrictions''')
   * biographyEnglish(group, 0-1, '''noRestrictions''')
     * language (colVar, 1-1, '''noRestrictions ''')
     * biography (textVar, 1-1, '''noRestrictions ''')
   * biographySwedish(group, 0-1, '''noRestrictions''')
     * language (colVar, 1-1, '''noRestrictions ''')
     * biography (textVar, 1-1, '''noRestrictions ''')
   
!3 Test av recordType för person
!4 Person
Läs recordType för '''person''' via  REST API.

!***> Läs posttyp Person

!| RecordEndpointFixture |
| authToken | type | id | testReadRecord? | getStatusType? |
| $adminAuthToken | recordType | person | | OK |

*!
Läs topnivå metadatagruppen för en '''ny''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till  personNewGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personNewGroup | |

Kontrollera barnen

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataGroup | recordInfoDivaAutogeneratedNewGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadataGroup | personNameGroup | 1 | 1 | authorisedName | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAcademicTitleTextVar | 0 | 1 | academicTitle | noRestrictions |
| $adminAuthToken | metadataTextVariable | yearOfBirthTextVar | 0 | 1 | yearOfBirth | noRestrictions |
| $adminAuthToken | metadataTextVariable | yearOfDeathTextVar | 0 | 1 | yearOfDeath | noRestrictions |
| $adminAuthToken | metadataTextVariable | personEmailTextVar | 0 | 1 | emailAddress | noRestrictions |
| $adminAuthToken | metadataGroup | personAlternativeNameGroup | 0 | X | alternativeName | noRestrictions |
| $adminAuthToken | metadataGroup | personURLGroup | 0 | X | externalURL | noRestrictions |
| $adminAuthToken | metadataRecordLink | personDomainPartLink | 0 | X | personDomainPart | noRestrictions |
| $adminAuthToken | metadataGroup | personOtherAffiliationGroup | 0 | X | otherAffiliation | noRestrictions |
| $adminAuthToken | metadataTextVariable | personORCIDValueTextVar | 0 | X | ORCID_ID | noRestrictions |
| $adminAuthToken | metadataTextVariable | personVIAFValueTextVar | 0 | X | VIAF_ID | noRestrictions |
| $adminAuthToken | metadataTextVariable | personLibrisValueTextVar | 0 | X | Libris_ID | noRestrictions |
| $adminAuthToken | metadataGroup | personBiographyEnglishGroup | 0 | 1 | biographyEnglish | noRestrictions |
| $adminAuthToken | metadataGroup | personBiographySwedishGroup | 0 | 1 | biographySwedish | noRestrictions |

*!

Läs topnivå metadatagruppen för en '''befintlig''' person, och kontrollera att den har rätt barn

!***> Kontrollera barnen till personGroup

Läs in metadatagruppen för senare kontroll

!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personGroup | |

Kontrollera barnen

!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataGroup | recordInfoPersonDivaGroup | 1 | 1 | recordInfo | noRestrictions |
| $adminAuthToken | metadataGroup | personNameGroup | 1 | 1 | authorisedName | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAcademicTitleTextVar | 0 | 1 | academicTitle | noRestrictions |
| $adminAuthToken | metadataTextVariable | yearOfBirthTextVar | 0 | 1 | yearOfBirth | noRestrictions |
| $adminAuthToken | metadataTextVariable | yearOfDeathTextVar | 0 | 1 | yearOfDeath | noRestrictions |
| $adminAuthToken | metadataTextVariable | personEmailTextVar | 0 | 1 | emailAddress | noRestrictions |
| $adminAuthToken | metadataGroup | personAlternativeNameGroup | 0 | X | alternativeName | noRestrictions |
| $adminAuthToken | metadataGroup | personURLGroup | 0 | X | externalURL | noRestrictions |
| $adminAuthToken | metadataRecordLink | personDomainPartLink | 0 | X | personDomainPart | noRestrictions |
| $adminAuthToken | metadataGroup | personOtherAffiliationGroup | 0 | X | otherAffiliation | noRestrictions |
| $adminAuthToken | metadataTextVariable | personORCIDValueTextVar | 0 | X | ORCID_ID | noRestrictions |
| $adminAuthToken | metadataTextVariable | personVIAFValueTextVar | 0 | X | VIAF_ID | noRestrictions |
| $adminAuthToken | metadataTextVariable | personLibrisValueTextVar | 0 | X | Libris_ID | noRestrictions |
| $adminAuthToken | metadataGroup | personBiographyEnglishGroup | 0 | 1 | biographyEnglish | noRestrictions |
| $adminAuthToken | metadataGroup | personBiographySwedishGroup | 0 | 1 | biographySwedish | noRestrictions |

*!
Läst in metadatagruppen recordInfoPersonDivaGroup för senare kontroll

!***> Kontrollera recordInfoPersonDivaGroup 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | recordInfoPersonDivaGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataTextVariable | idTextVar | 1 | 1 | id | noRestrictions |
| $adminAuthToken | metadataRecordLink | recordTypeLink | 1 | 1 | type | noRestrictions |
| $adminAuthToken | metadataRecordLink | createdByLink | 1 | 1 | createdBy | noRestrictions |
| $adminAuthToken | metadataRecordLink | dataDividerDivaLink | 1 | 1 | dataDivider | noRestrictions |
| $adminAuthToken | metadataTextVariable | tsCreatedTextVar | 1 | 1 | tsCreated | noRestrictions |
| $adminAuthToken | metadataGroup | updatedGroup | 1 | X | updated | noRestrictions |
| $adminAuthToken | metadataCollectionVariable | personPublicCollectionVar | 1 | 1 | public | noRestrictions |
| $adminAuthToken | metadataCollectionVariable | domainCollectionVar | 0 | X | domain | noRestrictions |

*!
!***> Kontrollera updated 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | updatedGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataRecordLink | updatedByLink | 1 | 1 | updatedBy | noRestrictions |
| $adminAuthToken | metadataTextVariable | tsUpdatedTextVar | 1 | 1 | tsUpdated | noRestrictions |
*!
!***> Kontrollera alternativeName 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personAlternativeNameGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataTextVariable | firstNameTextVar | 0 | 1 | givenName | noRestrictions |
| $adminAuthToken | metadataTextVariable | lastNameTextVar | 0 | 1 | familyName | noRestrictions |
*!
!***> Kontrollera externalURL 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personURLGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataTextVariable | personExternalURLLabelTextVar | 1 | 1 | linkTitle | noRestrictions |
| $adminAuthToken | metadataTextVariable | personExternalURLTextVar | 1 | 1 | URL | noRestrictions |
*!
!***> Kontrollera affiliation 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personAffiliationGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataRecordLink | divaOrganisationLink | 1 | 1 | organisationLink | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAffiliationFromTextVar | 0 | 1 | affiliationFromYear | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAffiliationUntilTextVar | 0 | 1 | affiliationUntilYear | noRestrictions |
*!
!***> Kontrollera otherAffiliation 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personOtherAffiliationGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataTextVariable | personOtherAffiliationTextVar | 1 | 1 | affiliation | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAffiliationFromTextVar | 0 | 1 | affiliationFromYear | noRestrictions |
| $adminAuthToken | metadataTextVariable | personAffiliationUntilTextVar | 0 | 1 | affiliationUntilYear | noRestrictions |
*!
!***> Kontrollera localIdentifier 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personIdentifiersLocalIdentifierGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataCollectionVariable | domainCollectionVar | 1 | 1 | domain | noRestrictions |
| $adminAuthToken | metadataTextVariable | personLocalValueTextVar | 1 | 1 | identifier | noRestrictions |
*!
!***> Kontrollera biographyEnglish 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personBiographyEnglishGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataCollectionVariable | alternativeNameLanguageEnCollectionVar | 1 | 1 | language | noRestrictions |
| $adminAuthToken | metadataTextVariable | personBiographyTextVar | 1 | 1 | biography | noRestrictions |
*!
!***> Kontrollera biographySwedish 
Läs in
!| RecordEndpointFixture |
| type | id | testReadRecordAndStoreJson? |
| metadataGroup | personBiographySwedishGroup | |

Kontrollera barnen
!| MetadataLinkFixture |
| authToken | linkedRecordType | linkedRecordId | getRepeatMin? | getRepeatMax? | getNameInData? | getRecordPartConstraint? |
| $adminAuthToken | metadataCollectionVariable | nameLanguageSvCollectionVar | 1 | 1 | language | noRestrictions |
| $adminAuthToken | metadataTextVariable | personBiographyTextVar | 1 | 1 | biography | noRestrictions |
*!


!3 Roller !style_red[OBS! ej aktiva än]
Notera att rättigheterna som kontrolleras i det här avsnittet gäller, vilka rättigheter man har på postTypen inte enstaka poster. Rättigheterna för enstaka poster kontrolleras under de olika testerna för rättigheter så som read, update, etc.

!4 !-SystemAdmin-!
!-SystemAdmin har tillgång till validate, list och search för person postTypen-!

!***> Kontrollera de actions systemAdmin får med i recordType för person

!define currentAuthToken {$systemAdminAuthToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing.}
#!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!4 !-DomainAdmin-!
!-DomainAdmin har tillgång till validate och search för person  postTypen-!

!***> Kontrollera de actions domainAdmin får med i recordType för person

!define currentAuthToken {$domainAdminUUAuthToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action list is missing.}
#!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
!4 !-Guest-!
!-Guest har tillgång till search för person postTypen-!

!***> Kontrollera de actions domainAdmin får med i recordType för person

!define currentAuthToken {$guestToken}
!define currentRecordType {person}
!define expectedPermissionResult {Action update is missing. Action delete is missing. Action index is missing. Action create is missing. Action validate is missing. Action list is missing.}
#!include -seamless .TheDiVATests.DivaTests.checkActionsForRecordType
*!
